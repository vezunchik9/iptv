#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ IPTV –æ—Ç –º—É—Å–æ—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

echo "üßπ –û–ß–ò–°–¢–ö–ê –ü–†–û–ï–ö–¢–ê IPTV –û–¢ –ú–£–°–û–†–ê"
echo "================================="
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
safe_remove() {
    local path="$1"
    local description="$2"
    local size=$(du -sh "$path" 2>/dev/null | cut -f1)
    
    if [ -e "$path" ]; then
        echo "üóëÔ∏è –ù–∞–π–¥–µ–Ω –º—É—Å–æ—Ä: $description ($size)"
        read -p "   –£–¥–∞–ª–∏—Ç—å? (y/N): " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            rm -rf "$path"
            echo "   ‚úÖ –£–¥–∞–ª–µ–Ω–æ: $description"
        else
            echo "   ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: $description"
        fi
        echo ""
    fi
}

# –ü–æ–¥—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–æ –æ—á–∏—Å—Ç–∫–∏
echo "üìä –†–∞–∑–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –î–û –æ—á–∏—Å—Ç–∫–∏:"
du -sh .
echo ""

# 1. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π)
echo "1Ô∏è‚É£ –û–ß–ò–°–¢–ö–ê –°–¢–ê–†–´–• –û–¢–ß–ï–¢–û–í"
echo "========================="

if [ -d "reports" ]; then
    # –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—ã–π –Ω–æ–≤—ã–π —Ñ–∞–π–ª –æ—Ç—á–µ—Ç–∞
    newest_report=$(ls -t reports/*.json 2>/dev/null | head -1)
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
    for report in reports/*.json; do
        if [ "$report" != "$newest_report" ] && [ -f "$report" ]; then
            safe_remove "$report" "–°—Ç–∞—Ä—ã–π –æ—Ç—á–µ—Ç: $(basename "$report")"
        fi
    done
else
    echo "   üìÇ –ü–∞–ø–∫–∞ reports –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi

# 2. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ)
echo "2Ô∏è‚É£ –û–ß–ò–°–¢–ö–ê –°–¢–ê–†–´–• –ë–≠–ö–ê–ü–û–í"
echo "========================="

if [ -d "backups" ]; then
    # –£–¥–∞–ª—è–µ–º –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 1 –¥–Ω—è
    find backups/ -name "*.backup.*" -mtime +1 -type f 2>/dev/null | while read backup; do
        safe_remove "$backup" "–°—Ç–∞—Ä—ã–π –±—ç–∫–∞–ø: $(basename "$backup")"
    done
    
    # –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏ –≤ –±—ç–∫–∞–ø–∞—Ö
    find backups/ -type d -empty -delete 2>/dev/null
else
    echo "   üìÇ –ü–∞–ø–∫–∞ backups –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi

# 3. –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
echo "3Ô∏è‚É£ –û–ß–ò–°–¢–ö–ê –î–£–ë–õ–ò–ö–ê–¢–û–í –ü–õ–ï–ô–õ–ò–°–¢–û–í"
echo "================================"

if [ -d "playlists" ]; then
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
    for backup in playlists/*.backup.*; do
        if [ -f "$backup" ]; then
            safe_remove "$backup" "–ë—ç–∫–∞–ø –ø–ª–µ–π–ª–∏—Å—Ç–∞: $(basename "$backup")"
        fi
    done
else
    echo "   üìÇ –ü–∞–ø–∫–∞ playlists –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi

# 4. –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
echo "4Ô∏è‚É£ –û–ß–ò–°–¢–ö–ê –í–†–ï–ú–ï–ù–ù–´–• –§–ê–ô–õ–û–í"
echo "==========================="

# –ü–æ–∏—Å–∫ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
temp_files=$(find . -name "*.tmp" -o -name "*.temp" -o -name "*~" -o -name ".DS_Store" 2>/dev/null)
if [ -n "$temp_files" ]; then
    echo "$temp_files" | while read temp_file; do
        safe_remove "$temp_file" "–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª: $(basename "$temp_file")"
    done
else
    echo "   ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
fi

# 5. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ Python
echo "5Ô∏è‚É£ –û–ß–ò–°–¢–ö–ê –ö–ï–®–ê PYTHON"
echo "======================"

pycache_dirs=$(find . -name "__pycache__" -type d 2>/dev/null)
if [ -n "$pycache_dirs" ]; then
    echo "$pycache_dirs" | while read pycache_dir; do
        safe_remove "$pycache_dir" "–ö–µ—à Python: $pycache_dir"
    done
else
    echo "   ‚úÖ –ö–µ—à–∞ Python –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
fi

# –ü–æ–¥—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏
echo ""
echo "üìä –†–ï–ó–£–õ–¨–¢–ê–¢ –û–ß–ò–°–¢–ö–ò:"
echo "===================="
echo "–†–∞–∑–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –ü–û–°–õ–ï –æ—á–∏—Å—Ç–∫–∏:"
du -sh .
echo ""

echo "üéâ –û–ß–ò–°–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
echo ""
echo "üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:"
echo "   ‚Ä¢ –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é"
echo "   ‚Ä¢ –í–∞–∂–Ω—ã–µ –±—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
echo "   ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–µ—Ç—Å—è"
echo ""
echo "üöÄ –î–ª—è –∑–∞–ø—É—Å–∫–∞: ./cleanup_project.sh"
