#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∞—Å–∏–≤—ã—Ö —ç–º–æ–¥–∑–∏ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ
"""

import re

# –°–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —ç–º–æ–¥–∑–∏
CATEGORY_EMOJIS = {
    '–ò–ù–§–û': '‚ÑπÔ∏è',
    '–≠—Ñ–∏—Ä–Ω—ã–µ': 'üì∫',
    '–ù–æ–≤–æ—Å—Ç–∏': 'üì∞', 
    '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ': '‚öΩ',
    '–ù–∞—à —Å–ø–æ—Ä—Ç': 'üèÉ‚Äç‚ôÇÔ∏è',
    '–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ': 'üéµ',
    '–ö–∏–Ω–æ –∏ —Å–µ—Ä–∏–∞–ª—ã': 'üé¨',
    '–ö–∏–Ω–æ–∑–∞–ª—ã': 'üçø',
    '–ö–∏–Ω–æ–∑–∞–ª—ã 2': 'üé≠',
    '–ö–∏–Ω–æ–∑–∞–ª—ã 3': 'üé™',
    '–ö–∏–Ω–æ–∑–∞–ª—ã RUTUBE': 'üìπ',
    '–ö–∏–Ω–æ–∑–∞–ª—ã –°–∏—Ç–∏ –≠–¥–µ–º': 'üèõÔ∏è',
    '–î–µ—Ç—Å–∫–∏–µ': 'üß∏',
    '–ü–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ': 'üß†',
    '–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ': 'üéä',
    '–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –ø–ª—é—Å': 'üá∑üá∫',
    '–†–µ–≥–∏o–Ω–∞–ª—å–Ω—ã–µ': 'üìç',
    '–†–∞–¥–∏–æ': 'üìª',
    '–†–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ': '‚õ™',
    'Fashion': 'üëó',
    'Relax': 'üßò‚Äç‚ôÇÔ∏è'
}

def add_emojis_to_playlist(input_file, output_file):
    """–î–æ–±–∞–≤–ª—è–µ—Ç —ç–º–æ–¥–∑–∏ –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ"""
    
    try:
        with open(input_file, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        pattern = r'# === ([^(]+) \((\d+ –∫–∞–Ω–∞–ª–æ–≤?)\) ==='
        
        def replace_header(match):
            category = match.group(1).strip()
            count = match.group(2)
            
            # –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π —ç–º–æ–¥–∑–∏
            emoji = CATEGORY_EMOJIS.get(category, 'üì∫')  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é üì∫
            
            return f'# === {emoji} {category} ({count}) ==='
        
        # –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        updated_content = re.sub(pattern, replace_header, content)
        
        # –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º group-title –≤ —Å–∞–º–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö
        for category, emoji in CATEGORY_EMOJIS.items():
            # –û–±–Ω–æ–≤–ª—è–µ–º –≤ —Å—Ç—Ä–æ–∫–∞—Ö EXTINF
            pattern_extinf = rf'group-title="{re.escape(category)}"'
            replacement_extinf = f'group-title="{emoji} {category}"'
            updated_content = re.sub(pattern_extinf, replacement_extinf, updated_content)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write(updated_content)
        
        print(f"‚úÖ –≠–º–æ–¥–∑–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ {output_file}")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        emoji_count = len([match for match in re.finditer(r'# === [^(]+ \([^)]+\) ===', updated_content)])
        print(f"üìä –û–±–Ω–æ–≤–ª–µ–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: {emoji_count}")
        
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False

def update_category_files():
    """–û–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∞–π–ª—ã –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å —ç–º–æ–¥–∑–∏"""
    
    import os
    
    category_mappings = {
        '–∏–Ω—Ñ–æ.m3u': ('‚ÑπÔ∏è', '–ò–ù–§–û'),
        '—ç—Ñ–∏—Ä–Ω—ã–µ.m3u': ('üì∫', '–≠—Ñ–∏—Ä–Ω—ã–µ'),
        '–Ω–æ–≤–æ—Å—Ç–∏.m3u': ('üì∞', '–ù–æ–≤–æ—Å—Ç–∏'),
        '—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ.m3u': ('‚öΩ', '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ'),
        '–Ω–∞—à_—Å–ø–æ—Ä—Ç.m3u': ('üèÉ‚Äç‚ôÇÔ∏è', '–ù–∞—à —Å–ø–æ—Ä—Ç'),
        '–º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ.m3u': ('üéµ', '–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ'),
        '–∫–∏–Ω–æ_–∏_—Å–µ—Ä–∏–∞–ª—ã.m3u': ('üé¨', '–ö–∏–Ω–æ –∏ —Å–µ—Ä–∏–∞–ª—ã'),
        '–∫–∏–Ω–æ–∑–∞–ª—ã.m3u': ('üçø', '–ö–∏–Ω–æ–∑–∞–ª—ã'),
        '–∫–∏–Ω–æ–∑–∞–ª—ã_2.m3u': ('üé≠', '–ö–∏–Ω–æ–∑–∞–ª—ã 2'),
        '–∫–∏–Ω–æ–∑–∞–ª—ã_3.m3u': ('üé™', '–ö–∏–Ω–æ–∑–∞–ª—ã 3'),
        '–∫–∏–Ω–æ–∑–∞–ª—ã_rutube.m3u': ('üìπ', '–ö–∏–Ω–æ–∑–∞–ª—ã RUTUBE'),
        '–∫–∏–Ω–æ–∑–∞–ª—ã_—Å–∏—Ç–∏_—ç–¥–µ–º.m3u': ('üèõÔ∏è', '–ö–∏–Ω–æ–∑–∞–ª—ã –°–∏—Ç–∏ –≠–¥–µ–º'),
        '–¥–µ—Ç—Å–∫–∏–µ.m3u': ('üß∏', '–î–µ—Ç—Å–∫–∏–µ'),
        '–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ.m3u': ('üß†', '–ü–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ'),
        '—Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ.m3u': ('üéä', '–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ'),
        '—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ_–ø–ª—é—Å.m3u': ('üá∑üá∫', '–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –ø–ª—é—Å'),
        '—Ä–µ–≥–∏o–Ω–∞–ª—å–Ω—ã–µ.m3u': ('üìç', '–†–µ–≥–∏o–Ω–∞–ª—å–Ω—ã–µ'),
        '—Ä–∞–¥–∏–æ.m3u': ('üìª', '–†–∞–¥–∏–æ'),
        '—Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ.m3u': ('‚õ™', '–†–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ'),
        'fashion.m3u': ('üëó', 'Fashion'),
        'relax.m3u': ('üßò‚Äç‚ôÇÔ∏è', 'Relax')
    }
    
    for filename, (emoji, category_name) in category_mappings.items():
        filepath = f'categories/{filename}'
        if os.path.exists(filepath):
            try:
                with open(filepath, 'r', encoding='utf-8') as f:
                    content = f.read()
                
                # –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                content = re.sub(r'# –ö–∞—Ç–µ–≥–æ—Ä–∏—è: [^\n]+', f'# –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {emoji} {category_name}', content)
                
                # –û–±–Ω–æ–≤–ª—è–µ–º group-title
                pattern = rf'group-title="{re.escape(category_name.replace(" –ø–ª—é—Å", "_–ø–ª—é—Å").replace(" ", "_").lower())}"'
                replacement = f'group-title="{emoji} {category_name}"'
                content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                
                with open(filepath, 'w', encoding='utf-8') as f:
                    f.write(content)
                
                print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª: {filename}")
                
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å —Ñ–∞–π–ª–æ–º {filename}: {e}")

if __name__ == "__main__":
    print("üé® –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø–ª–µ–π–ª–∏—Å—Ç–∞")
    print("="*50)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–µ–π–ª–∏—Å—Ç
    if add_emojis_to_playlist('playlists/televizo_main.m3u', 'playlists/televizo_main.m3u'):
        print("üéØ –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–µ–π–ª–∏—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω —Å —ç–º–æ–¥–∑–∏")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    print("\nüìÇ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...")
    update_category_files()
    
    print("\nüéâ –í—Å–µ —ç–º–æ–¥–∑–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
    print("\nüìã –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —ç–º–æ–¥–∑–∏:")
    for category, emoji in CATEGORY_EMOJIS.items():
        print(f"  {emoji} {category}")
